apply plugin: 'groovy'

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'org.codehaus.groovy:groovy-all:2.0.0',
                'org.spockframework:spock-core:0.7-groovy-2.0'
}

jar {
    manifest {
        attributes(
            "Main-Class": "com.dancorder.PhotoSync.PhotoSync",
            "Implementation-Version": getVersionTag())
    }
}

def getVersionTag() {
    def os = System.getProperty("os.name").toLowerCase()
    def gitCommand = os.contains("windows") ? 'git.cmd' : 'git'
    def stdout = new ByteArrayOutputStream()

    exec {
        commandLine gitCommand, 'describe', '--match', 'v*.*.*'
        standardOutput = stdout
    }

    return stdout.toString().trim()
}
